(function(){function n(e){var t=$('div [class*="window-header"]',$(e));t.mousedown(function(t){function n(t){var n=e.style.position;e.style.position="absolute",e.style.left=t.clientX+window.pageXOffset-e.innerX+"px",e.style.top=t.clientY+window.pageYOffset-e.innerY+"px",e.style.position=n}e.innerX=t.clientX+window.pageXOffset-e.offsetLeft,e.innerY=t.clientY+window.pageYOffset-e.offsetTop,window.addEventListener("mousemove",n,!1),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",n,!1)},!0)})}function r(e,t){var n=e.$el[0];t.mousedown(function(e){function t(e){var t=e.clientX-n.startX,r=e.clientY-n.startY;n.startX+=t,n.startY+=r,n.ow+=t,n.oh+=r;var i=n.style.position;n.style.position="absolute",n.style.width=n.ow*.9+"px",n.style.height=n.oh*.9+"px",n.style.position=i}n.startX=e.clientX,n.startY=e.clientY,n.ow=n.offsetWidth,n.oh=n.offsetHeight,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",t,!1)},!0)})}function f(e,t){var n=t.get("eType"),r=e.eResource().get("resourceSet"),i=r.elements();return _.filter(i,function(e){return e.isKindOf(n)})}function l(e,t,n,r){return function(){var i=n.eContainer;i&&(r.tree.setSelection(r.tree.selected.parent),t.get("upperBound")!==1?i.get(t).add(e.create()):i.set(t.get("name"),e.create()))}}function c(e,n){var r=e.get("eType"),i=r.get("abstract")?r.get("eAllSubTypes"):[r],s,o;_.each(i,function(r){o="Child "+r.get("name"),s=new t.DropDownItem({label:o,model:r}),s.on("click",function(){e.get("upperBound")===1?n.set(e.get("name"),r.create()):n.get(e).add(r.create())}),this.addItem(s)},this)}var t=Ecore.Edit={version:"0.3.0"};t.LabelProvider={getLabel:function(e){var t=e.eClass.get("name");return this[t]?this[t](e):e.eClass.get("name")},EClass:function(e){return e.get("name")},EDataType:function(e){return e.get("name")},EEnum:function(e){return e.get("name")},EEnumLiteral:function(e){return e.get("name")+" = "+e.get("value")},EAttribute:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+t},EReference:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+t},EOperation:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+"()"+t},EPackage:function(e){return e.get("name")},ResourceSet:function(e){return"resourceSet"},Resource:function(e){return e.get("uri")}},t.util={lastSegment:function(e){return _.isString(e)?e.slice(e.lastIndexOf("/")+1,e.length):null},getElements:function(e,t){var n=t.get("eType"),r=e.eResource().get("resourceSet"),i=r.elements();return _.filter(i,function(e){return e.isKindOf(n)})}},t.Window=Backbone.View.extend({_template:_.template('<div class="row-fluid"><div class="window-header"><span class="window-title"><%= title %></span><span class="window-actions"></span></div><div class="window-content"></div><div class="window-footer"></div></div>'),_resizeHandleTemplate:_.template('<div class="window-resize" style="z-index: 1000;"></div>'),_closeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-remove action-close"></i></a>'),_minimizeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-minus action-min"></i></a>'),_maximizeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-plus action-max"></i></a>'),events:{'click i[class*="action-close"]':"close",'click i[class*="action-min"]':"minimize",'click i[class*="action-max"]':"maximize"},title:"Window",draggable:!0,initialize:function(e){_.bindAll(this,"render","remove","close","minimize","maximize"),e||(e={}),this.parts=e.parts,e.title&&!this.title&&(this.title=e.title),e.height&&(this.height=e.height),e.draggable&&(this.draggable=e.draggable),e.content&&(this.content=e.content)},render:function(){this.remove();var e=this._template({title:this.title});return this.$el.addClass("window"),this.$el.removeClass("hidden"),this.$el.append(e),this.$header=$(".window-header",this.$el),$('span[class*="window-actions"]',this.$el).append(this._minimizeActionTemplate()).append(this._maximizeActionTemplate()).append(this._closeActionTemplate()),$(".window-footer",this.$el).append(this._resizeHandleTemplate()),this.$content=$('div > div[class*="window-content"]',this.$el),this.height&&this.$content.css("height",this.height),this.content&&(this.content.setElement(this.$content),this.content.render()),this.draggable&&n(this.$el[0]),r(this,$(".window-resize",this.$el)),this},remove:function(){return this.$content&&this.$content.remove(),this.$el&&(this.$el.children().remove(),this.$el.css("width",null),this.$el.css("height",null)),this},close:function(){this.remove(),this.$el.addClass("hidden")},maximize:function(){this.$el.ot=this.$el.css("top"),this.$el.ob=this.$el.css("bottom"),this.$el.or=this.$el.css("right"),this.$el.ol=this.$el.css("left"),this.$el.css("top",10),this.$el.css("bottom",0),this.$el.css("left",0),this.$el.css("right",0)},minimize:function(){this.$el.ot&&this.$el.css("top",this.$el.ot),this.$el.ob&&this.$el.css("bottom",this.$el.ob),this.$el.or&&this.$el.css("right",this.$el.or),this.$el.ol&&this.$el.css("left",this.$el.ol)}}),t.SimpleWindow=t.Window.extend({header:_.template("<div></div>"),initialize:function(e){this.title=e.title||"Window",this.height=e.height,this.draggable=e.draggable,this.content=e.content}}),t.MenuBar=Backbone.View.extend({template:_.template('<div class="span12 action-bar btn-group"></div>'),initialize:function(e){this.buttons=e.buttons},render:function(){var e=this.template();return this.$el.append(e),_.each(this.buttons,this.renderButton,this),this},renderButton:function(e){return e.render(),$('div[class*="action-bar"]',this.$el).append(e.$el),this}}),t.MenuBarButton=Backbone.View.extend({template:_.template('<a class="btn btn-<%= size %>"> <%= label %> </a>'),events:{click:"click"},initialize:function(e){_.bindAll(this,"render","click"),this.size=e.size||"mini",this.label=e.label},render:function(){var e=this.template({label:this.label,size:this.size});return this.setElement(e),this},click:function(e){this.trigger("click",e)}}),t.MenuBarDropDownButton=t.MenuBarButton.extend({template:_.template('<a class="btn btn-<%= size %>" data-toggle="dropdown"> <%= label %> <span class="caret"> </span></a><ul class="dropdown-menu"></ul>'),initialize:function(e){t.MenuBarButton.prototype.initialize.apply(this,[e]),this.label=e.label,this.items=e.items||[]},render:function(){return t.MenuBarButton.prototype.render.apply(this),this.removeItem(),_.each(this.items,this.renderItem,this),this},renderItem:function(e){return e.render(),$(this.$el[1]).append(e.$el),this},removeItem:function(e){return this.items.length=0,$(this.$el[1]).children().remove(),this},addItem:function(e){return this.items.push(e),this}}),t.Separator=Backbone.View.extend({template:_.template('<li class="divider"></li>'),render:function(){var e=this.template();return this.setElement(e),this}}),t.DropDownItem=Backbone.View.extend({template:_.template('<li><a tabindex="-1" href="#"><%= label %></a></li>'),events:{"click a":"click"},initialize:function(e){_.bindAll(this,"render","click"),this.label=e.label},render:function(){var e=this.template({label:this.label});return this.setElement(e),this},click:function(e){this.trigger("click",e)},remove:function(){Backbone.View.prototype.remove.apply(this)}});var i=Backbone.View.extend({template:"<div contenteditable></div>",render:function(){this.setElement(this.template),this.$el.append(String(this.model||0));var e=this;return this.$el.on("change",function(){e.trigger("change",e.$el.text())}),this}}),s=Backbone.View.extend({}),o=Backbone.View.extend({templateOptions:_.template("<% _.each(options, function(option) { %> <option> <%= option.eClass ? Ecore.Edit.LabelProvider.getLabel(option) : option %></option> <% }); %>"),initialize:function(e){e||(e={}),this.value=e.value,this.options=e.options},getLabel:function(e){return e?e.eClass?t.LabelProvider.getLabel(e):e:""},getValue:function(){var e=$("option:selected",this.$el).val();return _.find(this.options,function(t){return this.getLabel(t)===e},this)},render:function(){var e=this.templateOptions({options:this.options});this.$el.append(e),this.value===!0||this.value===!1?this.$el.val(""+this.value):this.$el.val(this.getLabel(this.value));var t=this;return this.$el.change(function(){var e=t.getValue();t.trigger("change",e)}),this}}),u=o.extend({template:_.template("<select></select>"),initialize:function(e){o.prototype.initialize.apply(this,[e])},render:function(){var e=this.template();return this.setElement(e),o.prototype.render.apply(this)}}),a=o.extend({template:_.template('<select multiple="multiple"></select>'),templateActions:_.template('<div class="btn-group"></div>'),templateAddAction:_.template('<a class="btn-mini"><i class="icon-plus"></i></a>'),templateDelAction:_.template('<a class="btn-mini"><i class="icon-remove"></i></a>'),initialize:function(e){o.prototype.initialize.apply(this,[e])},render:function(){var e=this.template();this.setElement(e),o.prototype.render.apply(this);var t=$(document.createElement("div"));return t.append(this.$el),this.setElement(t),this}});t.PropertyRow=Backbone.View.extend({propertyTemplate:_.template("<tr><td><%= name %></td></tr>"),valueTemplate:_.template("<td></td>"),initialize:function(e){_.bindAll(this,"renderEReference","renderEAttribute","renderEAttributeBoolean","render"),_.isObject(this.model.eFeature)?(this.eFeature=this.model.eFeature,this.eFeatureName=this.eFeature.get("name"),this.eType=this.eFeature.get("eType")):this.eFeatureName=this.model.eFeature,this.value=this.model.value,this.model.options?this.options=this.model.options:this.eFeature.get("upperBound")!==1?this.options=this.model.eObject.get(this.eFeatureName).array():this.options=f(this.model.eObject,this.eFeature)},renderEAttribute:function(e,t,n){var r;return t.get("many")||(t.get("eType")===Ecore.EBoolean?r=this.renderEAttributeBoolean(e,t,n||!1):(r=new i({model:n}),r.on("change",function(n){e.set(t.get("name"),n)}))),r},renderEAttributeBoolean:function(e,t,n){var r=new u({options:["true","false"],value:n});return r.on("change",function(n){e.set(t.get("name"),n)}),r},renderEReference:function(e,t,n){var r,i;return t.get("upperBound")!==1?(r=new a,i=function(n){e.get(t).add(n)}):(r=new u,i=function(n){e.set(t.get("name"),n)}),r.value=n,r.options=this.options,r.on("change",i),r},render:function(){var e=this.model.eObject,t=this.value||e.get(this.eFeatureName),n=this.propertyTemplate({name:this.eFeatureName}),r;this.setElement(n),this.eFeature?this.eFeature.isTypeOf("EAttribute")?r=this.renderEAttribute(e,this.eFeature,t):r=this.renderEReference(e,this.eFeature,t):r=new u({model:[t],value:t,options:this.options});if(r){r.render();var i=$(document.createElement("td"));i.append(r.$el),this.$el.append(i)}return this},remove:function(){return this.$el.remove(),this}}),$("[contenteditable]").on("focus",function(){var e=$(this);return e.data("before",e.html()),e}).on("blur keyup paste",function(){var e=$(this);return e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change")),e}),t.PropertySheet=Backbone.View.extend({template:_.template('<table class="table table-striped"></table>'),templateTableHead:_.template('<thead><tr><th style="width: 30%"></th><th style="width: 70%"></th></tr></thead>'),templateTableBody:_.template("<tbody></tbody>"),initialize:function(e){this.views=[]},remove:function(){return this.$el&&(this.$el.children().remove(),_.each(this.views,function(e){e.remove()}),this.views.length=0),this},render:function(){if(!this.model||!this.model.eClass)return;this.remove();var e=this.template(),t=this.templateTableHead(),n=this.templateTableBody();return this.$el.append(e),$("table",this.$el).append(t).append(n),this.tbody=$("table > tbody",this.$el),this.renderContent()},createRow:function(e,n,r,i){var s=new t.PropertyRow({model:{eFeature:e,eObject:n,value:r,options:i}});this.views.push(s)},createFeatureRow:function(e){return this.createRow(e,this.model)},renderRow:function(e){e.render(),this.tbody.append(e.$el)},renderContent:function(){var e=this.model.eClass,t=_.filter(e.get("eAllAttributes"),function(e){return!e.get("derived")}),n=_.filter(e.get("eAllReferences"),function(e){return!e.get("derived")}),r,i;return _.each(t,this.createFeatureRow,this),_.each(n,this.createFeatureRow,this),_.each(this.views,this.renderRow,this),this}}),t.Tab=Backbone.View.extend({template:_.template('<li><a href="#tab-<%= id %>" data-toggle="tab"> <%= title %> <i class="icon-remove-circle"></i> </a></li>'),events:{'click a > i[class="icon-remove-circle"]':"remove",mouseover:"_showClose",mouseout:"_hideClose"},initialize:function(e){this.title=e.title,this.editor=e.editor,this.part=e.part},render:function(){if(!this.$tab){var e=this.title||this.editor.getTitle(),t=this.template({id:this.part.cid,title:e});this.setElement(t),this.$tab=$("a",this.$el),this.$close=$('a > i[class="icon-remove-circle"]',this.$el),this._hideClose()}return this},remove:function(){return this.trigger("remove",this.editor),Backbone.View.prototype.remove.apply(this)},show:function(){this.$tab&&this.$tab.tab("show")},_showClose:function(){this.$close&&this.$close.css("display","inline-block")},_hideClose:function(){this.$close&&this.$close.css("display","none")}}),t.TabDropdown=Backbone.View.extend({template:_.template('<li class="dropdown"><a href="#" data-toggle="dropdown"> <%= title %> <i class="caret"></i></a></li>'),dropDownTemplate:'<ul class="dropdown-menu"></ul>',initialize:function(e){this.title=e.title,this.editor=e.editor,this.parts=e.parts,this.items=[]},render:function(){if(!this.$tab){var e=this.template({title:this.title});this.setElement(e),this.$tab=$("a",this.$el),this.$el.append(this.dropDownTemplate),this.$menu=$(".dropdown-menu",this.$el),_.each(this.items,this.renderItem,this)}return this},renderItem:function(t){var n;t.id?(n=_.template('<li><a href="#tab-<%= id %>" data-toggle="tab"><%= title %></a></li>'),this.$menu&&(this.$menu.append(n(t)),t.click&&$("a:last",this.$menu).click(function(e){e.preventDefault(),window.setTimeout(t.click,10)}))):(n=_.template('<li><a href="#"><%= title %></a></li>'),this.$menu&&(this.$menu.append(n(t)),$("a:last",this.$menu).click(function(){e.preventDefault(),t.click()})))},addDropItem:function(e,t,n){var r={title:e};return typeof t=="function"?r.click=t:r.id=t,typeof n=="function"&&(r.click=n),this.items.push(r),this},show:function(){this.$el&&$("li:eq(0) a",this.$el).tab("show")},remove:function(){return this.trigger("remove",this.editor),Backbone.View.prototype.remove.apply(this)}}),t.ContextMenu=Backbone.View.extend({template:'<div class="editor-contextmenu"><ul class="menu"></ul></div>',initialize:function(e){this.tree=e.tree,this.node=e.node},render:function(){return this.setElement(this.template),this.$menu=$(".menu",this.$el),this.$menu.append((new t.InsertChildEntry({menu:this,model:this.node.model})).render().$el),this.$menu.append((new t.InsertSiblingEntry({menu:this,model:this.node.model})).render().$el),this.$menu.append((new t.DeleteChildEntry({menu:this})).render().$el),this},center:function(){if(this.$el){var e=this.$el[0],t=this.node.$el.position();e.style.top=t.top+14+"px",e.style.left=t.left+14+"px"}return this},eraseNode:function(){this.node.erase(),this.remove()}}),t.ContextMenuEntry=Backbone.View.extend({template:_.template('<li><button class="<%= btnClass %>" title="<%= title %>"><div class="icon"></div> <%= label %></button><ul class="menu" id="<%= ulId %>"></ul></li>'),expanded:!1,events:{"click button":"expand"},initialize:function(e){this.menu=e.menu},render:function(){var e=this.template({btnClass:this.btnClass,title:this.title,label:this.label,ulId:this.ulId});return this.setElement(e),this.$menu=$("#"+this.ulId,this.$el),this},expand:function(){this.expanded?this.$menu.css("display","none"):(this.$menu.css("display","block"),this.$menu.css("padding","5px 10px")),this.expanded=!this.expanded}}),t.DeleteChildEntry=t.ContextMenuEntry.extend({template:_.template('<li><button class="<%= btnClass %>" title="<%= title %>"><div class="icon"></div> <%= label %></button></li>'),title:"Delete this element",label:"Delete",btnClass:"remove",expand:function(){this.menu.eraseNode(),this.menu.remove()}}),t.InsertChildEntry=t.ContextMenuEntry.extend({title:"Insert a new element as child",label:"Add Child",btnClass:"insert",ulId:"ulInsertChild",expand:function(){this.insertChild(),t.ContextMenuEntry.prototype.expand.apply(this)},insertChild:function(){var e=this.$menu,n=this.model,r=n.eClass.get("eAllContainments"),i=n.eContainingFeature;e.children().remove();var s=function(e,n,r){var i=e.get("eType"),s=_.filter(_.union([i],i.get("eAllSubTypes")),function(e){return!e.get("abstract")}),o,u,a;_.each(s,function(i){u="Child "+i.get("name"),o=new t.ContextMenuItem({label:u,model:n,type:i,feature:e}),r.append(o.render().$el),o.on("create",function(){this.menu.trigger("change",this.menu.node),this.menu.remove()},this)},this)};_.each(r,function(t){s.apply(this,[t,n,e])},this)}}),t.InsertSiblingEntry=t.ContextMenuEntry.extend({title:"Insert a new element as sibling",label:"Add Sibling",btnClass:"insert",ulId:"ulInsertSibling",expand:function(){this.insertSibling(),t.ContextMenuEntry.prototype.expand.apply(this)},insertSibling:function(){var e=this.$menu,n=this.model,r=n.eClass.get("eAllContainments"),i=n.eContainingFeature;e.children().remove();var s=function(e,t,n,r){return function(){var r=n.eContainer;r&&(t.get("upperBound")!==1?r.get(t).add(e.create()):r.set(t.get("name"),e.create()))}};if(i){var o=i.get("eType"),u=_.filter(_.union([o],o.get("eAllSubTypes")),function(e){return!e.get("abstract")}),a,f;_.each(u,function(r){a="Sibling "+r.get("name"),f=new t.ContextMenuItem({label:a,feature:i,type:r,model:n.eContainer}),e.append(f.render().$el),f.on("create",function(){this.menu.trigger("change",this.menu.node.parent),this.menu.remove()},this)},this)}}}),t.ContextMenuItem=Backbone.View.extend({template:_.template('<li><button class="insert"><div class="icon"></div><%= label %></button></li>'),events:{"click button":"create"},initialize:function(e){this.label=e.label,this.feature=e.feature,this.type=e.type},render:function(){return this.setElement(this.template({label:this.label})),this},create:function(){if(!this.model||!this.feature)return;this.feature.get("upperBound")===1?this.model.set(this.feature.get("name"),this.type.create()):this.model.get(this.feature).add(this.type.create()),this.trigger("create")}}),t.TreeNode=Backbone.View.extend({_marginHint:24,template:'<tr class="tree-item-tr"></tr>',table:'<table style="border-collapse; collapse; margin-left: 0px;"><tbody><tr></tr></tbody></table>',td:'<td class="tree-td"></td>',events:{mouseover:"highlight",mouseout:"unhighlight",click:"select",'click button[class="icon-edit-edit"]':"edit"},initialize:function(e){_.bindAll(this,"render","select","expand","collapse","highlight","unhighlight","edit"),this.tree=e.tree,this.parent=e.parent,this.margin=e.margin,this.children=[]},render:function(){return this.$el.children().length&&this.$el.children().remove(),this.setElement(this.template),this.model?_.each(this.createContent(),function(e){this.$el.append(e)},this):this.$el.append(this._createAddElement()),this},erase:function(){this.remove(),console.log(this.model.eContainer),console.log(this.model.eContainingFeature)},highlight:function(){return this.$el.css("background","rgba(255, 255, 102, 0.6)"),this.$el.css("cursor","pointer"),this},unhighlight:function(){return this.tree.selected!==this&&this.$el.css("background","rgba(255, 255, 255, 1)"),this.$el.css("cursor","auto"),this},select:function(e){return e&&e.stopImmediatePropagation(),this.$el&&this.$el.css("background","rgba(255, 255, 102, 0.4)"),this.expanded?this.collapse():this.expand(),this.tree.setSelection(this),this},deselect:function(){return this.$el&&this.$el.css("background","rgba(255, 255, 255, 1)"),this},edit:function(e){e.stopImmediatePropagation(),this.tree.editNode(this,e)},addNode:function(e){var n=_.last(this.children),r=new t.TreeNode({model:e,tree:this.tree,parent:this,margin:this.margin+this._marginHint});n&&(n.next=r),this.children.push(r),r.render();var i=function(e){return e?e.next&&e.next!==e?e.next:i(e.parent):null},s=i(this);return s?this.tree.$tbody[0].insertBefore(r.$el[0],s.$el[0]):this.tree.$tbody.append(r.$el),this},expand:function(){this.tree.contextMenu&&this.tree.contextMenu.remove(),this.expanded&&this.collapse(),this.expanded=!0;var e=this.model.eContents();return _.each(e,this.addNode,this),this},collapse:function(){return this.expanded=!1,_.each(this.children,function(e){e.remove()}),this.children.length=0,this},remove:function(){return _.each(this.children,function(e){e.remove()}),this.children.length=0,Backbone.View.prototype.remove.apply(this)},createContent:function(){var e=document.createElement("td"),t=document.createElement("button");t.className="icon-edit-edit",e.appendChild(t);var n=document.createElement("td");return n.className="tree-td",n.appendChild(this._createInnerTable()),[e,n]},_createEditElement:function(){var e=document.createElement("td");e.style.background="#F5F5F5",e.style.color="#CCCCCC",e.style.padding=0;var t=document.createElement("button");return copy.className="icon-edit icon-large",e.appendChild(copy),e},_createDeleteElement:function(){var e=document.createElement("td");e.style.background="#F5F5F5",e.style.color="#CCCCCC",e.style.padding=0;var t=document.createElement("div");return t.className="icon-remove icon-large",e.appendChild(t),e},_createCaretIcon:function(){var e=document.createElement("td");e.className="tree-td";var t=document.createElement("a");return t.className="icon-caret-right",t.style.color="grey",t.style.cursor="pointer",e.appendChild(t),e},_createNodeIcon:function(){var e=document.createElement("td");e.className="tree-td";var t=document.createElement("span");return t.className="icon-edit-"+this.model.eClass.get("name"),e.appendChild(t),e},_createNodeLabel:function(){var e=document.createElement("td");e.className="tree-td";var n=document.createElement("div");n.className="tree-label",e.appendChild(n);var r=t.LabelProvider.getLabel(this.model);return n.innerHTML=r,e},_createInnerTable:function(){var e=document.createElement("table");e.style.marginLeft=this.margin+"px",e.style.borderCollapse="collapse";var t=document.createElement("tbody"),n=document.createElement("tr");return n.appendChild(this._createCaretIcon()),n.appendChild(this._createNodeIcon()),n.appendChild(this._createNodeLabel()),t.appendChild(n),e.appendChild(t),e}}),t.Tree=Backbone.View.extend({template:'<table class="tree-table"></table>',tableTmpl:'<colgroup><col width="24px"><col></colgroup><tbody></tbody>',initialize:function(e){this.selected=null,this.nodes=[]},render:function(){return this.$body||(this.setElement(this.template),this.$el.append(this.tableTmpl),this.$tbody=$("tbody",this.$el),this.model.get("contents").each(this.addNode,this)),this},addNode:function(e){var n=_.last(this.nodes),r=new t.TreeNode({model:e,tree:this,margin:0});n&&(n.next=r),this.nodes.push(r),r.render(),this.$tbody.append(r.$el)},setSelection:function(e){this.selected&&(this.selected.deselect(),this.trigger("deselect",this.selected)),this.selected=e,this.trigger("select",this.selected)},remove:function(){return this.$body&&this.$body.remove(),_.each(this.nodes,function(e){e.remove()}),Backbone.View.prototype.remove.apply(this)},editNode:function(e,n){this.contextMenu&&this.contextMenu.remove(),this.contextMenu=new t.ContextMenu({node:e}),this.contextMenu.render(),this.$el.append(this.contextMenu.$el),this.contextMenu.center(),this.contextMenu.on("change",function(e){e&&e.expand()},this)}}),t.Part=Backbone.View.extend({menu:!1,_frame:'<div class="editor-frame"></div>',_menu:'<div class="editor-menu"></div>',_content:'<div class="editor-content-outer"><div class="editor-content"></div></div>',render:function(){return this.$content||(this.$el.append(this._frame),this.$frame=$(".editor-frame",this.$el),this.menu&&this.$frame.append(this._menu),this.$frame.append(this._content),this.$content=$(".editor-content",this.$frame),this.renderContent()),this},renderContent:function(){}}),t.PanelPart=t.Part.extend({_template:_.template('<div class="tab-pane" id="tab-<%= id %>"></div>'),render:function(){return this.$content||(this.setElement(this._template({id:this.cid})),this.$el.append(this._frame),this.$frame=$(".editor-frame",this.$el),this.menu&&this.$frame.append(this._menu),this.$frame.append(this._content),this.$content=$(".editor-content",this.$frame),this.renderContent()),this},renderContent:function(){}}),t.TreePart=t.Part.extend({initialize:function(e){this.tree=new t.Tree({model:this.model})},renderContent:function(){return this.tree.render(),this.$content.append(this.tree.$el),this.tree.on("select",function(e){this.trigger("select",e)},this),this.tree.on("deselect",function(e){this.trigger("deselect",e)},this),this},remove:function(){return this.off(),t.Part.prototype.remove.apply(this)}}),t.TreePanelPart=t.PanelPart.extend({initialize:function(e){this.tree=new t.Tree({model:this.model})},renderContent:function(){return this.tree.render(),this.$content.append(this.tree.$el),this.tree.on("select",function(e){this.trigger("select",e)},this),this.tree.on("deselect",function(e){this.trigger("deselect",e)},this),this},remove:function(){return this.off(),t.PanelPart.prototype.remove.apply(this)}}),t.TabPanel=Backbone.View.extend({template:'<ul class="nav nav-tabs"></ul><div class="tab-content"></div>',initialize:function(e){this.elements=[]},render:function(){return!this.$content&&!this.$tabs&&(this.$el.append(this.template),this.$el.addClass("tabbable"),this.$content=$(".tab-content",this.$el),this.$tabs=$(".nav-tabs",this.$el)),_.each(this.elements,function(e){e.render()}),this},add:function(e){this.get(e)||(this.elements.push(e),e.panel=this,e.on("remove",this.suppress,this))},get:function(e){return _.find(this.elements,function(t){return t===e})},getByModel:function(e){return _.find(this.editors,function(t){return t.model===e})},suppress:function(e){this.elements=_.without(this.elements,e),e.off("remove",this.suppress),this.elements.length&&this.show(this.elements[0])},show:function(e){e&&e.show()},open:function(e){var n=this.getByModel(e);n||(n=new t.TabEditor({model:e}),this.add(n),n.render()),n.show()}}),t.PanelElement=Backbone.View.extend({initialize:function(e){e||(e={}),this.title=e.title,this.panel=e.panel,this.tab=e.tab,this.part=e.part,this.tab.part=this.part,this.tab.on("remove",this.remove,this)},render:function(){return this.tab.render(),this.panel.$tabs.append(this.tab.$el),this.renderPart(this.part),this},renderPart:function(e){if(!e)return;e.render(),this.panel.$content.append(e.$el)},show:function(){this.tab&&this.tab.show()},remove:function(){return this.part&&this.tab&&(this.part.remove(),this.trigger("remove",this),delete this.part,delete this.tab),Backbone.View.prototype.remove.apply(this)}}),t.MultiPanelElement=t.PanelElement.extend({initialize:function(e){e||(e={}),this.title=e.title,this.panel=e.panel,this.tab=e.tab,this.parts=e.parts,this.tab.parts=this.parts,this.tab.on("remove",this.remove,this)},render:function(){return this.tab.render(),this.panel.$tabs.append(this.tab.$el),_.each(this.parts,this.renderPart,this),this},remove:function(){return this.parts&&this.tab&&(_.each(this.parts,function(e){e.remove()}),this.trigger("remove",this),this.parts.length=0,delete this.parts,delete this.tab),Backbone.View.prototype.remove.apply(this)}}),t.Editor=Backbone.View.extend({menu:!1,_frame:'<div class="editor-frame"></div>',_menu:'<div class="editor-menu"></div>',_content:'<div class="editor-content-outer"><div class="editor-content"></div></div>',initialize:function(e){},render:function(){var e;return this.$content||(this.setElement(this.template({id:this.cid})),this.$el.addClass("editor"),this.$el.append(this._frame),e=$(".editor-frame",this.$el),this.menu&&(e.append(this._menu),this.$menu=$(".editor-menu",e)),e.append(this._content),this.$content=$(".editor-content",e),this.$container&&this.$container.append(this.$el),this.renderContent()),this},renderContent:function(){},remove:function(){return this.trigger("remove"),Backbone.View.prototype.remove.apply(this)}}),t.PanelEditor=t.PanelElement.extend({initialize:function(e){e||(e={}),e.title||(e.title=t.util.lastSegment(this.model.get("uri"))),e.tab=new t.Tab({title:e.title,editor:this}),t.PanelElement.prototype.initialize.apply(this,[e])}}),t.TabEditor=t.Editor.extend({template:_.template('<div class="tab-pane" id="tab-<%= id %>"></div>'),initialize:function(e){t.Editor.prototype.initialize.apply(this,[e]),this.tab=new t.Tab({editor:this,model:this.model,title:e.title}),this.tab.on("remove",this.remove)},render:function(){return this.$tabs&&!this.tab.isRender&&this.$tabs.append(this.tab.render().$el),t.Editor.prototype.render.apply(this),this},show:function(){$('a[href="#tab-'+this.cid+'"]',this.$tabs).tab("show")},getTitle:function(){var e;return this.title?this.title:this.model?(e=this.model.get("uri"),e.slice(e.lastIndexOf("/")+1,e.length)):"unnamed"}}),t.TreeTabEditor=t.TabEditor.extend({menu:!0,_menuGroup:'<div class="btn-group"></div>',initialize:function(e){_.bindAll(this),t.TabEditor.prototype.initialize.apply(this,[e]),this.tree=new Ecore.Edit.Tree({model:this.model}),this.model.on("change add",function(e){var t=this.tree.selected;t&&(t.render(),t.expanded&&t.expand())},this),this.model.on("remove",function(e){this.tree.selected.parent&&(this.tree.setSelection(this.tree.selected.parent),this.tree.selected.expand())},this)},renderContent:function(){this.$content.append(this.tree.render().$el),this.$menu.append(this._createMenu())},addElement:function(e){var n=this.tree.selected;if(!n)return;var r=this.add,i=n.model,s=i.eClass.get("eAllContainments"),o=i.eContainingFeature;r.removeItem(),_.each(s,function(e){c.apply(r,[e,i])});if(o){var u=o.get("eType"),a=u.get("abstract")?u.get("eAllSubTypes"):[u],f,h;s.length&&r.addItem(new t.Separator),_.each(a,function(e){f="Sibling "+e.get("name"),h=new t.DropDownItem({label:f}),r.addItem(h),h.on("click",l(e,o,i,this))},this)}_.each(r.items,r.renderItem,r)},removeElement:function(){var e=this.tree.selected;if(!e)return;var t=e.model.eContainingFeature,n=e.model.eContainer;n?t.get("upperBound")!==1?n.get(t).remove(e.model):n.set(t.get("name"),null):e.model.eResource().get("contents").remove(e.model)},editElement:function(){},_createMenu:function(){var e=$(this._menuGroup);return this.add=new t.MenuBarDropDownButton({label:"add",size:"small"}),this.remove=new t.MenuBarButton({label:"remove",size:"small"}),this.edit=new t.MenuBarButton({label:"edit",size:"small"}),this.add.on("click",this.addElement),this.remove.on("click",this.removeElement),this.edit.on("click",this.editElement),e.append(this.add.render().$el).append(this.remove.render().$el).append(this.edit.render().$el),e}})})();